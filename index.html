<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EMI Risk Dashboard</title>

  <!-- ‚úÖ Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ‚úÖ React + Babel (must load in this order) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-gray-100">
  <div id="root"></div>

  <!-- ‚úÖ your whole app -->
  <script type="text/babel">

    const { useState, useEffect } = React;

    function App() {
      const [user, setUser] = useState(null);
      const [isSignup, setIsSignup] = useState(false);
      const [form, setForm] = useState({ username: "", password: "", confirm: "", name: "", email: "", phone: "", bank: "", acc: "" });
      const [tab, setTab] = useState("home");

      // helpers
      const getUsers = () => JSON.parse(localStorage.getItem("users") || "{}");
      const saveUsers = (u) => localStorage.setItem("users", JSON.stringify(u));
      const getLogged = () => localStorage.getItem("logged");
      const setLogged = (u) => u ? localStorage.setItem("logged", u) : localStorage.removeItem("logged");
      const mask = (a) => (a ? "****" + a.slice(-4) : "‚Äî");

      useEffect(() => {
        const logged = getLogged();
        if (logged) {
          const users = getUsers();
          if (users[logged]) setUser({ username: logged, ...users[logged] });
        }
      }, []);

      const login = () => {
        const { username, password } = form;
        const users = getUsers();
        if (!users[username]) return alert("User not found!");
        if (users[username].password !== password) return alert("Wrong password!");
        setUser({ username, ...users[username] });
        setLogged(username);
      };

      const signup = () => {
        const { username, password, confirm, name, email } = form;
        if (!username || !password || !confirm || !name || !email) return alert("Fill all fields");
        if (password !== confirm) return alert("Passwords don't match");
        const users = getUsers();
        if (users[username]) return alert("User exists");
        users[username] = { password, name, email, phone: form.phone, bank: form.bank, acc: form.acc, emis: [] };
        saveUsers(users);
        setUser({ username, ...users[username] });
        setLogged(username);
      };

      const logout = () => { setUser(null); setLogged(null); };

      const addEmi = (income, emi, sDate, dDate) => {
        const ratio = emi / income;
        let risk = ratio > 0.5 ? "High" : ratio > 0.3 ? "Medium" : "Low";
        const users = getUsers();
        const u = users[user.username];
        u.emis.unshift({ id: Date.now(), income, emi, sDate, dDate, risk, paid: false });
        users[user.username] = u;
        saveUsers(users);
        setUser({ username: user.username, ...u });
      };

      if (!user) {
        return (
          <div className="flex items-center justify-center min-h-screen bg-gradient-to-r from-purple-500 to-pink-500 p-6">
            <div className="bg-white rounded-2xl p-8 shadow-lg w-full max-w-md">
              <h1 className="text-2xl font-bold text-center mb-4">{isSignup ? "Sign Up" : "Login"}</h1>
              <div className="space-y-3">
                <input placeholder="Username" className="border w-full p-2 rounded" value={form.username} onChange={(e)=>setForm({...form, username:e.target.value})}/>
                {isSignup && <>
                  <input placeholder="Full Name" className="border w-full p-2 rounded" value={form.name} onChange={(e)=>setForm({...form,name:e.target.value})}/>
                  <input placeholder="Email" className="border w-full p-2 rounded" value={form.email} onChange={(e)=>setForm({...form,email:e.target.value})}/>
                  <input placeholder="Phone" className="border w-full p-2 rounded" value={form.phone} onChange={(e)=>setForm({...form,phone:e.target.value})}/>
                  <input placeholder="Bank Name" className="border w-full p-2 rounded" value={form.bank} onChange={(e)=>setForm({...form,bank:e.target.value})}/>
                  <input placeholder="Account Number" className="border w-full p-2 rounded" value={form.acc} onChange={(e)=>setForm({...form,acc:e.target.value})}/>
                </>}
                <input type="password" placeholder="Password" className="border w-full p-2 rounded" value={form.password} onChange={(e)=>setForm({...form,password:e.target.value})}/>
                {isSignup && <input type="password" placeholder="Confirm Password" className="border w-full p-2 rounded" value={form.confirm} onChange={(e)=>setForm({...form,confirm:e.target.value})}/>}

                <button onClick={isSignup?signup:login} className="w-full bg-gradient-to-r from-purple-600 to-pink-500 text-white py-2 rounded font-semibold">{isSignup?"Sign Up":"Login"}</button>

                <p onClick={()=>setIsSignup(!isSignup)} className="text-center text-purple-600 underline cursor-pointer">
                  {isSignup?"Already have an account? Login":"New user? Sign up"}
                </p>
              </div>
            </div>
          </div>
        );
      }

      const emis = user.emis || [];
      const total = emis.length;
      const paid = emis.filter(e=>e.paid).length;
      const remain = total - paid;
      const currentRisk = emis[0]?.risk || "‚Äî";
      const nextDue = emis.filter(e=>!e.paid).map(e=>e.dDate).sort()[0] || "‚Äî";

      return (
        <div className="min-h-screen">
          <header className="bg-gradient-to-r from-purple-600 to-pink-500 text-white p-5 flex justify-between">
            <h1>Welcome, {user.name}</h1>
            <button onClick={logout} className="bg-white/20 px-4 py-1 rounded">Logout</button>
          </header>

          <div className="max-w-4xl mx-auto mt-6 px-4">
            <div className="flex gap-2 mb-6">
              {["home","reminders","profile"].map(t=>(
                <button key={t} onClick={()=>setTab(t)} className={`flex-1 py-2 rounded ${tab===t?"bg-purple-600 text-white":"bg-white border text-gray-600"}`}>
                  {t==="home"?"üè† Home":t==="reminders"?"üîî Reminders":"üë§ Profile"}
                </button>
              ))}
            </div>

            {tab==="home"&&(
              <div className="bg-white rounded-xl shadow p-6">
                <h3 className="font-semibold mb-3">Add EMI</h3>
                <input id="inc" placeholder="Monthly Income" className="border p-2 w-full mb-2 rounded"/>
                <input id="emi" placeholder="EMI Amount" className="border p-2 w-full mb-2 rounded"/>
                <input id="sal" type="date" className="border p-2 w-full mb-2 rounded"/>
                <input id="due" type="date" className="border p-2 w-full mb-2 rounded"/>
                <button onClick={()=>{
                  const i=+document.getElementById("inc").value;
                  const e=+document.getElementById("emi").value;
                  const s=document.getElementById("sal").value;
                  const d=document.getElementById("due").value;
                  if(!i||!e||!s||!d)return alert("Fill all fields");
                  addEmi(i,e,s,d);
                  alert("EMI added!");
                }} className="bg-purple-600 text-white px-4 py-2 rounded">Save EMI</button>
              </div>
            )}

            {tab==="reminders"&&(
              <div className="bg-white rounded-xl shadow p-6">
                <h3 className="font-semibold mb-4">Your EMIs</h3>
                {emis.length===0?<p>No EMIs yet.</p>:emis.map(e=>(
                  <div key={e.id} className="p-3 border rounded mb-2 flex justify-between">
                    <div><p>‚Çπ{e.emi} ‚Äì {e.risk} risk</p><p className="text-sm text-gray-500">Due: {e.dDate}</p></div>
                    <button onClick={()=>{
                      const users=getUsers();
                      const u=users[user.username];
                      u.emis=u.emis.map(x=>x.id===e.id?{...x,paid:!x.paid}:x);
                      users[user.username]=u;
                      saveUsers(users);
                      setUser({username:user.username,...u});
                    }} className="text-sm bg-purple-100 px-3 py-1 rounded">{e.paid?"Mark Unpaid":"Mark Paid"}</button>
                  </div>
                ))}
              </div>
            )}

            {tab==="profile"&&(
              <div className="bg-white rounded-xl shadow p-6">
                <h3 className="font-semibold mb-4">Profile</h3>
                <p><b>Name:</b> {user.name}</p>
                <p><b>Email:</b> {user.email}</p>
                <p><b>Phone:</b> {user.phone||"‚Äî"}</p>
                <p><b>Bank:</b> {user.bank||"‚Äî"}</p>
                <p><b>Account:</b> {mask(user.acc)}</p>
                <div className="mt-4">
                  <h4 className="font-semibold mb-1">EMI Overview</h4>
                  <p>Total: {total}, Paid: {paid}, Remaining: {remain}</p>
                  <p>Current Risk: {currentRisk}</p>
                  <p>Next Due: {nextDue}</p>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);

  </script>
</body>
</html>
